<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Companhias e Destinos com Emirates Automático</title>
  <style>
    body { font-family: Arial; background: #111; color: #fff; padding: 15px; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; border-radius: 5px; border: none; }
    button { background: #007bff; color: white; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #444; text-align: left; vertical-align: middle; }
    th { background: #222; }
    td { background: #333; }
    .remove-btn { background: red; border: none; color: white; padding: 5px 10px; border-radius: 4px; }
    img.logo { height: 30px; vertical-align: middle; margin-right: 8px; }
    textarea { width: 100%; height: 150px; margin-top: 15px; border-radius: 5px; padding: 10px; }
  </style>
</head>
<body>
  <h2>✈️ Registro com Logos e Emirates Automático</h2>

  <label>Companhia Aérea:</label>
  <input type="text" id="companhia" placeholder="Ex: Air France" />

  <label>Cidade (Destino):</label>
  <input type="text" id="cidade" placeholder="Ex: Paris" />

  <label>Código ICAO:</label>
  <input type="text" id="icao" placeholder="Ex: LFPG" />

  <button id="addBtn">Adicionar</button>
  <button onclick="exportar()">Salvar Tabela</button>

  <table id="tabela">
    <thead>
      <tr>
        <th>Logo</th>
        <th>Destino</th>
        <th>ICAO</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <textarea id="output" placeholder="Aqui aparecerá a lista completa para copiar..."></textarea>

  <script>
    const companhiaInput = document.getElementById('companhia');
    const cidadeInput = document.getElementById('cidade');
    const icaoInput = document.getElementById('icao');
    const tabela = document.querySelector('#tabela tbody');
    const output = document.getElementById('output');
    let registros = JSON.parse(localStorage.getItem('registros')) || [];

    function normalizarNome(nome) {
      return nome.toLowerCase().replace(/[^a-z0-9]/g, "_");
    }

    function atualizarTabela() {
      registros.sort((a, b) => a.companhia.localeCompare(b.companhia));
      tabela.innerHTML = "";

      registros.forEach((e, index) => {
        const linha = tabela.insertRow();

        const logoCell = linha.insertCell(0);
        const img = document.createElement("img");
        img.className = "logo";
        img.src = "logos/" + normalizarNome(e.companhia) + ".png";
        img.onerror = () => { img.src = "logos/default.png"; };
        logoCell.appendChild(img);

        linha.insertCell(1).innerText = e.cidade;
        linha.insertCell(2).innerText = e.icao;

        const cellRemove = linha.insertCell(3);
        const btn = document.createElement("button");
        btn.innerText = "✖";
        btn.className = "remove-btn";
        btn.onclick = () => {
          registros.splice(index, 1);
          localStorage.setItem('registros', JSON.stringify(registros));
          atualizarTabela();
        };
        cellRemove.appendChild(btn);
      });
    }

    function exportar() {
      let linhas = registros.map(e => `${e.companhia} - ${e.cidade} (${e.icao})`);
      output.value = linhas.join("\n");
    }

    function adicionarEntrada(companhia, cidade, icao) {
      const existe = registros.some(e =>
        e.companhia.toLowerCase() === companhia.toLowerCase() &&
        e.cidade.toLowerCase() === cidade.toLowerCase() &&
        e.icao.toUpperCase() === icao
      );
      if (!existe) {
        registros.push({ companhia, cidade, icao });
      }
    }

    document.getElementById('addBtn').addEventListener('click', () => {
      const companhia = companhiaInput.value.trim();
      const cidade = cidadeInput.value.trim();
      const icao = icaoInput.value.trim().toUpperCase();

      if (!companhia || !cidade || !icao) {
        alert("Preencha todos os campos!");
        return;
      }

      adicionarEntrada(companhia, cidade, icao);

      // Adicionar Emirates se ainda não existir para esse destino
      adicionarEntrada("Emirates", cidade, icao);

      localStorage.setItem('registros', JSON.stringify(registros));
      atualizarTabela();

      companhiaInput.value = "";
      cidadeInput.value = "";
      icaoInput.value = "";
    });

    window.onload = () => {
      // Atualização retroativa da Emirates
      const destinosUnicos = new Set();
      registros.forEach(e => {
        if (e.companhia.toLowerCase() !== 'emirates') {
          const chave = `${e.cidade.toLowerCase()}|${e.icao.toUpperCase()}`;
          destinosUnicos.add(chave);
        }
      });

      destinosUnicos.forEach(dest => {
        const [cidade, icao] = dest.split('|');

        // Procurar a cidade original com capitalização correta
        const original = registros.find(e =>
          e.cidade.toLowerCase() === cidade &&
          e.icao.toUpperCase() === icao &&
          e.companhia.toLowerCase() !== 'emirates'
        );

        const cidadeFormatada = original ? original.cidade : cidade;

        const emiratesJaTem = registros.some(e =>
          e.companhia.toLowerCase() === 'emirates' &&
          e.cidade.toLowerCase() === cidade &&
          e.icao.toUpperCase() === icao
        );

        if (!emiratesJaTem) {
          registros.push({ companhia: "Emirates", cidade: cidadeFormatada, icao });
        }
      });

      localStorage.setItem('registros', JSON.stringify(registros));
      atualizarTabela();
    };
  </script>
</body>
</html>
